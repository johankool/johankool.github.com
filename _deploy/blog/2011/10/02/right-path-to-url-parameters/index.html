
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Right Path to URL Parameters - Koolistov</title>
  <meta name="author" content="Johan Kool">

  
  <meta name="description" content="It is very common to have to construct URLs in iOS apps. Unfortunately there is no such things as NSMutableURL, so we need to come up with our own &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.koolistov.net/blog/2011/10/02/right-path-to-url-parameters">
  <link href="/./favicon.png" rel="icon">
  <link href="/./stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/./javascripts/modernizr-2.0.js"></script>
  <script src="/./javascripts/ender.js"></script>
  <script src="/./javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Koolistov" type="application/atom+xml">
  <link href="/./apple-touch-icon.png" rel="apple-touch-icon" />
<!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Coming+Soon' rel='stylesheet' type='text/css'>
<!-- Google Webmasters tool -->
<meta name="google-site-verification" content="aQXE9vCD3QjNp7xGnUKCTLwPJBJ1cdr6bPVO2pOro6I" />
<meta name="google-site-verification" content="aN8hIjVAB2gp1sImatDmi7gZkHBTSUAH9Hd6whpackk" />
<meta name="google-site-verification" content="Fdgqd5dr_QcBpDw7KhTvPaqhwnVfSyGiQcSB4uYyod8" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-285308-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/./">Koolistov</a></h1>
  
    <h2>-- where apps are made</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.koolistov.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/./products/">Products</a></li>
  <li><a href="/./services/">Services</a></li>
  <li><a href="/./blog/">Blog</a></li>
  <li><a href="/./contact/">Contact</a></li>
  <!-- <li><a href="/./blog/archives/">Archives</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Right Path to URL Parameters</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-02T00:40:00+08:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>It is very common to have to construct URLs in iOS apps. Unfortunately there is no such things as <code>NSMutableURL</code>, so we need to come up with our own solution. Most developers seem to take a very pragmatic approach to this. Basically, you take a base URL, append a path and/or parameters to it, and go about your business. Almost, if not all, code I have seen do this make assumptions about the base URL: for example, no query or fragment present in the URL. Sometimes even relying on the other parts of the app always providing text that is safe to use in an URL. It can be quite a safe assumption that this is safe within your app, but I wanted a solution that is safe to use no matter what the base URL looked like, or what text was provided for the parameters.</p>

<!--more-->


<h3>URL Building Blocks</h3>

<p>Let&#8217;s have a quick look at how a URL is constructed. The various parts of an URL are:</p>

<pre><code>scheme://username:password@domain:port/path?query#fragment
</code></pre>

<p>The pragmatic approach works well if the base URL does not contain a path, query and fragment. The presence of a path is usually not a problem, it gets trickier when a query is already present, and most solutions definitely fail when a fragment is present.</p>

<p>The code provided below takes the presence of path, query and/or fragment into account. Don&#8217;t just take my word for it, you can run the provided unit test to ensure it does it right.</p>

<h3>Path</h3>

<p>To replace a path complete, use <code>- (NSURL *)URLByReplacingPathWithPath:(NSString *)path</code>. Alternatively, use <code>- (NSURL *)URLByAppendingPathWithRelativePath:(NSString *)path</code> if you want to append a relative path. This also allows to you walk up the path using for example <code>../foo</code>. The path will get simplified if possible.</p>

<h3>Parameter</h3>

<p>The most effective way to add parameters is to use <code>- (NSURL *)URLByAppendingParameters:(NSDictionary *)parameters</code>. The dictionary is expected to contain <code>NSString</code>s as keys. The corresponding values may be either <code>NSString</code>s or should respond to the method <code>- (NSString *)stringValue</code>, otherwise the value will default to  <code>- (NSString *)description</code>. Both keys and values will get URL escaped.</p>

<p>It is valid in an URL to have a parameter name appear multiple times, unlike it is for keys in <code>NSDictionary</code>. You can work around this by calling the method <code>- (NSURL *)URLByAppendingParameterName:(NSString *)parameter value:(id)value</code> multiple times with the same parameter name.</p>

<h3>Code</h3>

<p>The code is available as a <a href="https://gist.github.com/1256354">gist on GitHub</a>. The license for the code is a simple BSD license. You don&#8217;t need to attribute me or Koolistov in your app (although appreciated if you do), but you need to leave the copyright notice intact on the source files.</p>

<div><script src='https://gist.github.com/1256354.js?file='></script>
<noscript><pre><code>//
//  NSURL+PathParameters.h
//
//  Created by Johan Kool on 27/9/2011.
//  Copyright 2011 Koolistov Pte. Ltd. All rights reserved.
//
//  Redistribution and use in source and binary forms, with or without modification, are 
//  permitted provided that the following conditions are met:
//
//  * Redistributions of source code must retain the above copyright notice, this list of 
//    conditions and the following disclaimer.
//  * Neither the name of KOOLISTOV PTE. LTD. nor the names of its contributors may be used to 
//    endorse or promote products derived from this software without specific prior written 
//    permission.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY 
//  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF 
//  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL 
//  THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
//  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT 
//  OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) 
//  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, 
//  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
//  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//


#import &lt;Foundation/Foundation.h&gt;

@interface NSURL (PathParameters)

- (NSURL *)URLByReplacingPathWithPath:(NSString *)path;
- (NSURL *)URLByAppendingPathWithRelativePath:(NSString *)path;
- (NSURL *)URLByAppendingParameters:(NSDictionary *)parameters;
- (NSURL *)URLByAppendingParameterName:(NSString *)parameter value:(id)value;

@end
</code></pre></noscript></div>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Johan Kool</span></span>

      








  


<time datetime="2011-10-02T00:40:00+08:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/./blog/categories/cocoa/'>Cocoa</a>, <a class='category' href='/./blog/categories/nsurl/'>NSURL</a>, <a class='category' href='/./blog/categories/objective-c/'>Objective-C</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/./blog/2011/09/24/antiquated-icons-and-junk-drawers/" title="Previous Post: Antiquated Icons and Junk Drawers">&laquo; Antiquated Icons and Junk Drawers</a>
      
      
        <a class="basic-alignment right" href="/./blog/2011/10/06/steve-jobs/" title="next Post: Steve Jobs">Steve Jobs &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/./blog/2011/12/19/breaking-the-silence/">Breaking the Silence</a>
      </li>
    
      <li class="post">
        <a href="/./blog/2011/10/06/steve-jobs/">Steve Jobs</a>
      </li>
    
      <li class="post">
        <a href="/./blog/2011/10/02/right-path-to-url-parameters/">Right Path to URL Parameters</a>
      </li>
    
      <li class="post">
        <a href="/./blog/2011/09/24/antiquated-icons-and-junk-drawers/">Antiquated Icons and Junk Drawers</a>
      </li>
    
      <li class="post">
        <a href="/./blog/2011/09/17/a-fresh-new-website/">A Fresh New Website</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Koolistov">@Koolistov</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Koolistov',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/./javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Stack Overflow</h1>
  <br />
  <a href="http://stackoverflow.com/users/60488/johan-kool"><img src="http://stackoverflow.com/users/flair/60488.png?theme=clean" width="208" height="58" alt="profile for Johan Kool at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for Johan Kool at Stack Overflow, Q&amp;A for professional and enthusiast programmers"></a>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("johankool", 5, false);
    });
  </script>
  <script src="/./javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/johankool" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @johankool</a>
  
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Koolistov Pte. Ltd. - <a href="/generalconditions/">Terms &amp; Conditions</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'koolistov';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.koolistov.net/blog/2011/10/02/right-path-to-url-parameters/';
        var disqus_url = 'http://www.koolistov.net/blog/2011/10/02/right-path-to-url-parameters/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
